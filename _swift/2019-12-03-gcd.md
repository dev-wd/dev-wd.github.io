---
title: "Swift Multi-Threading, Example based Understanding GCD (Grand Central Dispatch)"
date: 2019-12-03 19:02:49 -0400
layout: post
categories: swift
---




In Swift, Grand Central Dispatch API (GCD) sopports thread programming.

Just using GCD is not difficult, but there are many preceding concepts to understand.


After understanding concepts, I arrange three types of gcd queues, and queues examples accordingly.

## Preceding concepts
### Synchronous vs. Asynchronous
When the new thread is forked from original threa, we do the task parrallely.

Synchoronous origin thread wait until ending new thread. After new thread exit tasks, then origin thread get the return value of that thread, and continue the tasks.

Asynchoronous origin thread do not wait until the end of new thread. Therefore, Asynchoronous origin thread immediately get return value from new thread, and continue task.


### Serial vs Concurrent Queue

iOS supports either serial queue and concurrent queue GCD. 

Serial queue is FIFO(First In, First Out), which usually called as queue in data structure concepts.

##### But then, what is concurrent queue?

Before knowing concurrent queue, we need to know 'concurrent' first.

It is easy to mistake that Concurrent is Parallelism.

When we do multi- threading, we can see threads are running parallely.

System memory resource is limitied and should be occupied by a thread, OS needs to switch thread which occupying OS memory resource continously. we call this situation as Concurrency.

Therefore, Relationship between parallelism and concurrency is like below.

##### Parallelism requires concurrency, but concurrency does not guarantee parallelism.

These are all concepts which included in GCD.

##  Three types of gcd queues
### Main queue
Main queue is queue running on the main thread of iOS, ans is serial queue.



### Global queues
Global queues are running on the many thread in whole iOS, and they are all concurrent queues.

Especially, Global queue supports specific properties which is called Quality of Service (QoS).
QoS has 4 properties which decides priority on concurrent global queue.

#### QoS
- User - Interactive
- User-initiated
- Utility
- Background


### Coustom queues
Custom queues are created by user, it can be either serial and concurrent.


## Examples

### Global Sync
```swift

DispatchQueue.global().sync {
    print("global start!=============")
    for i in 1...5 {
       print("🍊"+" \(i)ea")
    }
    print("global end!  =============")
}

for i in 1...5 {
    print("🍎"+" \(i)ea")
}


```

```
global start!=============
🍊 1ea
🍊 2ea
🍊 3ea
🍊 4ea
🍊 5ea
global end!  =============
🍎 1ea
🍎 2ea
🍎 3ea
🍎 4ea
🍎 5ea

```


### Global Async

```swift 
// 1 trial
global start!=============
🍎 1ea
🍊 1ea
🍎 2ea
🍎 3ea
🍊 2ea
🍎 4ea
🍎 5ea
🍊 3ea
🍊 4ea
🍊 5ea
global end!  =============

// 2 trial
global start!=============
🍎 1ea
🍊 1ea
🍎 2ea
🍊 2ea
🍎 3ea
🍊 3ea
🍎 4ea
🍎 5ea
🍊 4ea
🍊 5ea
global end!  =============


```
### Custom Serial Sync
```swift 
let WDFruits = DispatchQueue(label: "WD")

WDFruits.sync {
    print("custom start!=============")

    for i in 1...5 {
        print("🍑"+" \(i)ea")

    }
    print("custom   end!=============")

}

WDFruits.sync {
    print("custom start!=============")

    for i in 1...5 {
        print("🍊"+" \(i)ea")

    }
    print("custom   end!=============")

}

for i in 1...5 {
    print("🍎"+" \(i)ea")
}

```

```
custom start!=============
🍑 1ea
🍑 2ea
🍑 3ea
🍑 4ea
🍑 5ea
custom   end!=============
custom start!=============
🍊 1ea
🍊 2ea
🍊 3ea
🍊 4ea
🍊 5ea
custom   end!=============
🍎 1ea
🍎 2ea
🍎 3ea
🍎 4ea
🍎 5ea
```

### Custom Serial Async 
```swift
let WDFruits = DispatchQueue(label: "WD")

WDFruits.async {
    print("custom start!=============")

    for i in 1...5 {
        print("🍑"+" \(i)ea")

    }
    print("custom   end!=============")

}

WDFruits.async {
    print("custom start!=============")

    for i in 1...5 {
        print("🍊"+" \(i)ea")

    }
    print("custom   end!=============")

}

for i in 1...5 {
    print("🍎"+" \(i)ea")
}

```


```
custom start!=============
🍑 1ea
🍎 1ea
🍎 2ea
🍑 2ea
🍎 3ea
🍑 3ea
🍎 4ea
🍎 5ea
🍑 4ea
🍑 5ea
custom   end!=============
custom start!=============
🍊 1ea
🍊 2ea
🍊 3ea
🍊 4ea
🍊 5ea
custom   end!=============
```

